#! /usr/bin/env python3

"""
Input: stdin
{
  "per-node": [...], // new transion labels: tal output
  "?per-node": [...], // previous tree transion labels
  ... // other keys ignored
}

Output: stdout
[ merged per-node elements ]
"""

import sys, json

# ----------------------------------------------------------------------

def main():
    data = json.load(sys.stdin)
    new_labels = data["per-node"]
    sort_by_node_id(new_labels)
    new_by_name = make_by_name(new_labels)
    old_labels = data["?per-node"]
    sort_by_node_id(old_labels)
    old_by_name = make_by_name(old_labels)
    # print(json.dumps(new_labels, indent=2))
    print(make_output(new_labels))

# ----------------------------------------------------------------------

def make_by_name(src):
    by_name = {}
    for en in by_name:
        by_name.setdefault(en["name"], []).append(en)
    for val in by_name.values():
        val.sort()
    return by_name

# ----------------------------------------------------------------------

def sort_by_node_id(src):
    src.sort(key=lambda en: int(en["node_id"].split(".")[0]))

# ----------------------------------------------------------------------

def make_output(src):
    keys_order = ["name", "label", "node_id", "show", "?first", "?last", "?before first", "?after last"]
    val_width = {k: 0 for k in keys_order}
    for en in src:
        for key in keys_order:
            val_width[key] = max(val_width[key], len(make_val(en.get(key))))
    output = "[\n"
    for en in src:
        output += "            {"
        for key in keys_order:
            comma = "," if key != keys_order[-1] else ""
            value = make_val(en.get(key))
            alignment = " " * (val_width[key] - len(value) + 1)
            output += f"\"{key}\": {value}{comma}{alignment}"
        output += "},\n"
    output = output[:-2] + "\n]" # remove traling comma
    return output

# ----------------------------------------------------------------------

def make_val(src):
    return json.dumps(src)

# ======================================================================

main()
